SNS("SNS.util.Popup",function(){(function(b){var a=YAHOO.util.Event,c=YAHOO.util.Dom,f=YAHOO.lang;var e=function(k,j){var i=Array.prototype.slice.call(arguments);if(typeof k=="function"){return k.apply(j||this,i.slice(2))}};var h='<div class="sns-popup-mask"></div><div class="sns-popup"><div class="hd"><h3>{title}</h3></div><div class="bd"><span class="icon"></span>{content}</div><div class="ft"><div class="buttons"></div><a href="#" title="\u5173\u95ed\u6b64\u7a97\u53e3" class="btn-close">x</a></div></div>';var d={title:"",type:"",extraWrapperClass:"",content:"",useAnim:false,autoShow:true,width:350,hideMask:false,focus:0,buttons:[{text:"\u786e\u5b9a",func:function(){this.hide()}}]};var g=function(i,j){this.context=j||document.body;this.config=f.merge(d,i||{});this.init()};g.prototype={init:function(){var j=document.createElement("div"),n=this.config;c.setStyle(j,"display","none");if(YAHOO.lang.isString(n.content)){j.innerHTML=KISSY.substitute(h,n)}else{j.innerHTML=KISSY.substitute(h,f.merge(n,{content:""}));(c.getElementsByClassName("bd","div",j)[0]).appendChild(n.content)}if(n.hideMask){c.addClass(j,"sns-popup-hidemask")}c.addClass(j,"sns-popup-wrapper "+n.extraWrapperClass);var k=c.getElementsByClassName("sns-popup","div",j)[0];if(n.width){c.setStyle(k,"width",n.width+"px")}if(n.type){c.addClass(k,n.type)}var x=c.getElementsByClassName("buttons","div",k)[0],p=0,u=n.buttons,r=u.length;if(r){for(;p<r;p++){var m=document.createElement("button");m.innerHTML="<span>"+u[p].text+"</span>";a.on(m,"click",u[p].func,this,true);x.appendChild(m)}}else{c.setStyle(x,"display","none")}var l=c.getElementsByClassName("btn-close","a",k)[0];if(l){a.on(l,"click",function(i){a.stopEvent(i);this.hide()},this,true)}a.on(document,"keypress",function(i){if(27==a.getCharCode(i)){this.hide()}},this,true);if(6==YAHOO.env.ua.ie||n.iframeShim){var v=document.documentElement;var w=v.scrollTop||document.body.scrollTop;c.setStyle(j,"position","absolute");c.setStyle(j,"z-index","999999");c.setStyle(j,"top",w+"px");var o=document.createElement("iframe");o.setAttribute("frameborder","0");o.setAttribute("scrolling","no");o.src="about:blank";o.style.cssText="position:absolute; top: 0px; left: 0px; z-index: -1; filter:alpha(opacity=0);";c.setStyle(o,"width",(v.clientWidth||document.body.clientWidth)-20+"px");c.setStyle(o,"height",(v.clientHeight||document.body.clientHeight)+"px");c.setStyle(j,"height",(v.clientHeight||document.body.clientHeight)+"px");j.appendChild(o);var t=c.getElementsByClassName("sns-popup-mask","div",j)[0],s;var q=function(y){var i=function(){if(t){c.setStyle(t,"width",c.getViewportWidth()+"px");c.setStyle(t,"height",c.getViewportHeight()+"px")}var A=v.scrollTop||document.body.scrollTop;var z=v.scrollHeight||document.body.scrollHeight;if(A+(v.clientHeight||document.body.clientHeight)>z){return}c.setStyle(j,"top",A+"px");c.setStyle(j,"zoom","1.2");c.setStyle(j,"zoom","")};if(s){s.cancel()}s=YAHOO.lang.later(10,null,i,null,false)};a.on(window,"scroll",q,this,true);a.on(window,"resize",q,this,true);q()}this.context.appendChild(j);this.wrapper=j;this.popup=k;if(n.autoShow){this.show()}},show:function(){var i=this.config;if(i.onShow){e(i.onShow,this)}c.setStyle(this.wrapper,"display","");if(i.useAnim){c.setStyle(this.popup,"opacity","0");this.anim=new YAHOO.util.Anim(this.popup,{opacity:{to:1}},0.5);this.anim.animate()}YAHOO.lang.later(20,this,function(){try{(this.popup.getElementsByTagName("button")[i.focus]).focus()}catch(j){}},null,false)},hide:function(){var i=this.config;if(i.useAnim&&this.animate){this.animate.stop()}c.setStyle(this.wrapper,"display","none");if(i.onHide){e(i.onHide,this)}}};b.sys.Popup=g})(SNS);(function(){function a(c){if(c instanceof Function){c=c()}var d=function(){var e=(this.initialize)?this.initialize.apply(this,arguments):this;return e};a._build(d,c);var b=d.prototype.parent;b=b?b:Object;d.constructor=a;d.prototype.constructor=d;return d}a.mixin=function(d,b){if(d){for(var c in (b||{})){if(b[c]!=null){d[c]=b[c]}}return d}};a.mixinFun=function(d,b,c){var e=function(f){d(f);b(f)};return function(){e.apply(c,arguments)}};a.clone=function(d){var b;switch(typeof(d)){case"object":b={};for(var f in d){b[f]=a.clone(d[f])}break;case"array":b=[];for(var e=0,c=d.length;e<c;e++){b[e]=a.clone(d[e])}break;default:return d}return b};a._build=function(b,c,f){if(typeof(c)=="object"){for(var g in c){a._build(b,g,c[g])}return b}var e=a.inheritance[c];if(e){f=e.call(b,f);if(f==null){return b}}var d=b.prototype;switch(typeof(f)){case"object":d[c]=a.clone(f);break;case"function":f._name=c;d[c]=f;break;case"array":d[c]=a.clone(f);break;default:d[c]=f;break}};a.inheritance={extend:function(b){this.parent=b;var c=function(){};c.prototype=b.prototype;this.prototype=new c();this.prototype.parent=function(){this._sope=arguments.callee._owner;var d=this._sope.parent.prototype[arguments.callee.caller._name];if(!d){throw new Error('The method "'+method+'" has no parent.')}this._sope=arguments.callee._owner;return d.apply(this,arguments)};this.prototype.parent._owner=this},implement:function(b){var d=[];if(typeof(b)=="array"){d=b}else{d.push(b)}for(var c=0;c<d.length;c++){var e=d[c];if(typeof(e)=="function"){d[c]=new e()}a.mixin(this.prototype,d[c])}},statics:function(b){a.mixin(this,b)}};SNS.sys.Class=a})();(function(){var a={compose:function(c,d){var p,k,b,l=[];for(var o in c){var n=c[o];switch(o){case"ref":b=n;break;case">>":l=n;break;default:p=o;k=n;break}}if(!p){return}var m=c[p].nodeName?c[p]:document.createElement(p);if(b){this[b]=m}a.setAttr(m,k,d);if(l){if(typeof l=="string"){m.innerHTML=l}else{for(var g=0;g<l.length;g++){var h=l[g].num||1;for(var f=0;f<h;f++){var e=arguments.callee.call(this,l[g]);if(e){m.appendChild(e)}}}}}return m},setAttr:function(g,b,d){var c=d?d:0;for(var f in b){var e=b[f];switch(f){case"style":a.setStyle(g,e);break;case"className":g.className=e;break;default:g.setAttribute?g.setAttribute(f,e):g[f]=e;break}}},setStyle:function(d,b){for(var c in b){d.style[c]=b[c]}}};SNS.sys.JsonHtml=a})();(function(){var c=SNS.sys.Class,h=SNS.sys.JsonHtml,g=YAHOO.util.Dom,m=YAHOO.util.Event;var i;var l=new c({initialize:function(o,n){this.config={width:"350px",height:"",className:"panel",zIndex:999,top:"0px",left:"0px",offsetTop:0,offsetLeft:0,opacity:0,state:"hide",iframeShim:true,alphaShim:false,hideHandle:true,blurHide:false,hideHandleRight:"10px",hideHandleTop:"14px",container:document.body,unit:"px",autoHide:false,onShow:function(){},onHide:function(){},onRemove:function(){}};this.build(o,n)},build:function(o,n){this.modifyConfig(n);this.createHtml(o);this.place();this.attach();this.matchCoor(this.iframeShim,this.container);this.matchCoor(this.alphaShim,this.container);if(this.config.state=="hide"){this.container.style.display="none"}},modifyConfig:function(n){c.mixin(this.config,n)},htmlConfig:function(p,r){var q={},o={},n={};if(this.config.iframeShim){q={iframe:{className:"iframeShim",frameborder:0,style:r.iframeShim},ref:"iframeShim"}}if(this.config.alphaShim){o={div:{className:"alphaShim",style:r.alphaShim},ref:"alphaShim"}}if(this.config.hideHandle){n={span:{className:"hide-handle sns-icon icon-del-nob",style:r.hide},ref:"hideHandle"}}return{div:{className:this.config.className,style:r.container},ref:"container",">>":[q,o,{div:{className:"panel-main-content",style:r.mainContent},ref:"mainContent",">>":[{div:{className:"panel-content",style:r.content},ref:"content",">>":p},n]}]}},styleConfig:function(){var n={container:{top:this.config.top,left:this.config.left,position:"absolute",zIndex:this.config.zIndex,width:this.config.width,height:this.config.height,display:"none"},mainContent:{position:"relative",zIndex:15}};if(this.config.alphaShim){n.alphaShim={position:"absolute",top:"0px",left:"0px",zIndex:5,opacity:this.config.opacity,filter:"alpha(opacity="+this.config.opacity*100+")",backgroundColor:"#000"}}if(this.config.iframeShim){n.iframeShim={position:"absolute",top:"0px",left:"0px",zIndex:4,opacity:0,filter:"alpha(opacity=0)"}}if(this.config.hideHandle){n.hide={display:"block",width:"10px",height:"10px",position:"absolute",top:this.config.hideHandleTop,right:this.config.hideHandleRight,cursor:"pointer",zIndex:20}}return n},createHtml:function(p){var o=this;if(p.nodeType){this.container=this;return}var n=this.htmlConfig(p,this.styleConfig());var q=h.compose.call(this,n);if(!i){document.body.insertBefore(q,document.body.childNodes[0])}else{KISSY.DOM.insertAfter(q,i)}i=q;if(this.config.documentShim){this.documentShim=new SNS.sys.DocumentShim({opacity:this.config.opacity})}},matchCoor:function(o,n){var p=this.container.style.display;this.container.style.visibility="hidden";this.container.style.display="block";if(o){o.style.height=n.offsetHeight+"px"}if(o){o.style.width=n.offsetWidth+"px"}this.container.style.display=p;this.container.style.visibility=""},place:function(){this.container.style.top=parseInt(this.config.top)+parseInt(this.config.offsetTop)+this.config.unit;this.container.style.left=parseInt(this.config.left)+parseInt(this.config.offsetLeft)+this.config.unit;return this},attach:function(){var n=this;if(this.config.hideHandle){m.on(this.hideHandle,"click",this.hide,this,true)}if(this.config.blurHide){m.on(this.mainContent,"click",function(){this.eventPassBy=true},this,this);m.on(document,"click",function(){if(!this.eventPassBy){this.hide()}this.eventPassBy=null},this,this)}},show:function(){var n=this;this.config.state="show";this.container.style.display="block";if(this.config.documentShim){this.documentShim.show()}this.config.onShow.apply(this,arguments);if(this.onShow){this.onShow.apply(this,arguments)}},hide:function(){this.config.state="hide";this.container.style.display="none";if(this.config.documentShim){this.documentShim.hide()}this.config.onHide.apply(this,arguments);if(this.onHide){this.onHide.apply(this,arguments)}},remove:function(){this.container.parentNode.removeChild(this.container);if(this.config.documentShim){this.documentShim.remove()}this.config.onRemove.apply(this,arguments)},addEvent:function(r,n,q,o){var s=g.getElementsByClassName(r,n,this.container);for(var p=0;p<s.length;p++){m.on(s[p],q,o,s[p],this)}}});var f=new c({extend:l,initialize:function(p,o){this.parent(p,o);var n=this;if(this.config.autoHide){this._timer=window.setTimeout(function(){n.hide();if(n._timer){window.clearTimeout(n._timer)}},this.config.autoHide)}},modifyConfig:function(n){this.config.opacity=0;this.config.alphaShim=true;this.config.hideHandle=true;this.config.state="show";this.config.fixed=true;this.parent(n)},styleConfig:function(){var n=this.parent();n.container={width:"100%",height:"100%",position:this.config.fixed?"fixed":"absolute",top:"0px",left:"0px",zIndex:this.config.zIndex};c.mixin(n.mainContent,{margin:"auto",width:this.config.width,height:this.config.height});return n},createHtml:function(p){this.parent(p);var n=this;g.setStyle(n.container,"visibility","hidden");var o=function(r){var s=document.documentElement.scrollTop||document.body.scrollTop;var q=document.documentElement.scrollHeight||document.body.scrollHeight;g.setStyle(n.container,"width",(document.documentElement.clientWidth||document.body.clientWidth)+"px");g.setStyle(n.container,"height",g.getViewportHeight()+"px");g.setStyle(n.container,"top",s+"px");g.setStyle(n.container,"zoom","1");g.setStyle(n.container,"zoom","");n.matchCoor(n.iframeShim,n.container);n.matchCoor(n.alphaShim,n.container)};if(this.config.fixed){if(6==YAHOO.env.ua.ie){this.container.style.position="absolute";o();m.on(window,"scroll",o,this,true);m.on(window,"resize",o,this,true)}}else{o()}this.mainContent.style.top=(this.container.offsetHeight-this.mainContent.offsetHeight)/2+"px";setTimeout(function(){g.setStyle(n.container,"visibility","visible")},50)},place:function(){}});var j=new c({extend:l,initialize:function(p,o,n){this.el=p;this.parent(o,n)},modifyConfig:function(n){this.config.coordinate=[3,4];this.config.hideHandle=false;this.config.blurHide=true;this.config.showHandle=true;this.parent(n)},place:function(){var n=this.getCoordinate(this.el);this.container.style.left=n.x+parseInt(this.config.offsetLeft)+this.config.unit;this.container.style.top=n.y+parseInt(this.config.offsetTop)+this.config.unit;return this},getCoordinate:function(){var o=this.config.coordinate;var t=this.getPointPosition(this.el,o[0]);this.container.style.visibility="hidden";this.container.style.display="block";var q=this.container.offsetHeight,p=this.container.offsetWidth;this.container.style.display="none";this.container.style.visibility="";var r=[[0,-q],[-p,-q],[-p,0],[0,0]];var s=t.y+r[o[1]-1][1];var n=t.x+r[o[1]-1][0];return{x:n,y:s}},getPointPosition:function(o,n){var q=g.getXY(o);q={x:q[0],y:q[1]};switch(n){case 1:q.x+=o.offsetWidth;break;case 2:break;case 3:q.y+=o.offsetHeight;break;case 4:q.y+=o.offsetHeight;q.x+=o.offsetWidth;break}return q},attach:function(){this.parent();if(this.config.showHandle){m.on(this.el,"click",function(n){m.stopEvent(n);this.place();this.show();this.eventPassBy=true},this,true)}}});var e=function(p,o){var p='<div class="sns-panel-wrap"></div><div class="sns-panel"><div class="sns-panel-content">'+p+"</div></div>";var n=new l(p,o);var q=g.getElementsByClassName("sns-panel-wrap","div",n.content)[0];n.matchCoor(q,n.mainContent);return n};var d=function(r,p,o){var p='<div class="sns-panel-wrap"></div><div class="sns-panel"><div class="sns-panel-content">'+p+"</div></div>";var n=new j(r,p,o);var q=g.getElementsByClassName("sns-panel-wrap","div",n.content)[0];n.autoHeight=function(){n.matchCoor(q,n.mainContent)};n.autoHeight();return n};var k=function(p,o){var p='<div class="sns-panel-wrap"></div><div class="sns-panel"><div class="sns-panel-content">'+p+"</div></div>";var n=new f(p,o);var q=g.getElementsByClassName("sns-panel-wrap","div",n.content)[0];n.autoHeight=function(){n.matchCoor(q,n.mainContent)};window.setTimeout(function(){n.autoHeight()},10);return n};var b=function(r){var q={title:"\u5c0f\u63d0\u793a",content:"dialog",hideHandle:true,width:"350px",confirmBtn:function(){this.hide()},cancelBtn:function(){this.hide()}};SNS.sys.Class.mixin(q,r);var n='<div class="buttons">';if(q.confirmBtn){n+='<button class="confirm"><span>\u786e\u5b9a</span></button>'}if(q.cancelBtn){n+='<button class="cancel"><span>\u53d6\u6d88</span></button>'}n+="</div>";var p='<div class="hd"><h3>'+q.title+'</h3></div><div class="bd">'+q.content+'</div><div class="ft">'+n+'</div><a href="#" title="\u5173\u95ed\u6b64\u7a97\u53e3" class="btn-close"></a></div>';var o=SNS.sys.snsCenterPanel(p,q);if(q.confirmBtn){o.addEvent("confirm","button","click",q.confirmBtn)}if(q.cancelBtn){o.addEvent("cancel","button","click",q.cancelBtn)}return o};var a=new c({initialize:function(n){this.config={opacity:0,zIndex:998};c.mixin(this.config,n);this.build()},build:function(){var n=g.getDocumentWidth()+"px";var q=g.getDocumentHeight()+"px";this.mask=document.createElement("div");this.maskIframe=document.createElement("iframe");this.mask.className="document-shim";this.maskIframe.className="document-shim";var p=this.mask.style;var o=this.maskIframe.style;var r={top:"0",left:"0",position:"absolute",zIndex:this.config.zIndex,width:n,height:q,overflow:"hidden",backgroundColor:"#000",opacity:this.config.opacity,filter:"alpha(opacity="+this.config.opacity*100+")"};c.mixin(p,r);c.mixin(o,r);document.body.insertBefore(this.mask,document.body.childNodes[0]);document.body.insertBefore(this.maskIframe,document.body.childNodes[0]);this.mask.style.display="none";this.maskIframe.style.display="none"},show:function(){this.mask.style.display="block";this.maskIframe.style.display="block"},hide:function(){this.mask.style.display="none";this.maskIframe.style.display="none"},remove:function(){this.mask.parentNode.removeChild(this.mask);this.maskIframe.parentNode.removeChild(this.maskIframe)}});SNS.sys.Panel=l;SNS.sys.CenterPanel=f;SNS.sys.NearbyPanel=j;SNS.sys.snsPanel=e;SNS.sys.snsCenterPanel=k;SNS.sys.snsNearbyPanel=d;SNS.sys.snsDialog=b;SNS.sys.DocumentShim=a})();(function(){var b=YAHOO,d=b.util,a=d.Dom,k=d.Event,g=b.lang,h=d.Connect,c=d.Get,f=b.env,e=f.ua,i=KISSY,j=document;TB={},TB.widget={},TB.widget.SimplePopupPlus={decorate:function(){var o=TB.widget.SimplePopupPlus;var t=document.createElement("DIV");a.addClass(t,"sns-popup-mask-back");document.body.appendChild(t);var r=new YAHOO.util.CustomEvent("onClickMask");k.on(t,"click",function(u){r.fire(u)});var m=function(v,w){var u=k.getTarget(w);if(a.isAncestor(this.popup,u)){return}if(r.subscribers.length<2){this.hide()}};var l=null;var s=function(x){var w=k.getTarget(x),u=k.getCharCode(x);if(u!==9||(a.isAncestor(l,w)&&!x.shiftKey)){return}k.stopEvent(x);if(!x.shiftKey){try{var v=l.getElementsByTagName("A")[0];v&&v.focus()}catch(x){}}};var q=function(u){l=u;k.on(document,"keydown",s)};var n=function(){l=null;k.removeListener(document,"keydown",s)};var p=function(w){if(!w.config.autoFit){return}var x=a.getViewportWidth(),v=a.getViewportHeight(),z=a.getDocumentScrollTop(),y=a.getRegion(w.popup),u=w.config.height||y.height;if(y.right>x){a.setStyle(w.popup,"left",y.left-(y.right-x)+"px")}if(y.top+u>z+v){a.setStyle(w.popup,"top",y.top-(z+v-y.top-u))}if(y.top<z){a.setStyle(w.popup,"top",z+"px")}};o.decorate=function(w,u,z){if(YAHOO.env.ua.ie===6){var y="TODO"}g.augmentObject(z,{onClickMask:m});var x=z.onHide,v=z.onShow;z.onShow=function(){var D=document.documentElement;var C=this;setTimeout(function(){p(C)},0);q(this.popup);r.subscribe(this.config.onClickMask,this,true);v&&v.apply(this,arguments);a.setStyle(t,"display","block");a.setStyle(t,"width",D.scrollWidth+"px");a.setStyle(t,"height",D.scrollHeight+"px");a.setStyle(t,"zoom","1")};z.onHide=function(){n();r.unsubscribe(this.config.onClickMask,this);x&&x.apply(this,arguments);if(r.subscribers.length<1){a.setStyle(t,"display","none")}};var B=TB.widget.SimplePopup;var A=B.decorate.apply(B,arguments);A.mask=t;a.setStyle(A.popup,"z-index","8901");return A};return o.decorate.apply(o,arguments)}}})()});
