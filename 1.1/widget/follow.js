SNS("SNS.widget.Follow",function(){var f=YAHOO.util,d=f.Dom,a=f.Event,e=YAHOO.lang,c=SNS.sys.Helper;var b=function(h){var g={followUrl:"http://jianghu.{serverHost}/admin/star/follow_star.htm?tracelog=dr001",cancelFollowUrl:"http://jianghu.{serverHost}/admin/star/cancelFollow.htm",recommendUrl:"http://jianghu.{serverHost}/admin/json/recommendStar.htm?tracelog=dr004",checkFriendsUrl:"http://jianghu.{serverHost}/json/spell_search_json.htm",maybeFriendsUrl:"http://jianghu.{serverHost}/admin/recommend/friendMaybeBox.htm?size=14",addFriendsUrl:"http://jianghu.{serverHost}/admin/json/addFriends.htm",addBlackListUrl:"http://jianghu.{serverHost}/admin/json/add_to_my_black_list.htm",removeBlackListUrl:"http://jianghu.{serverHost}/admin/json/remove_off_my_black_list.htm"};this.config=YAHOO.lang.merge(g,h||{});this.init()};b.prototype={init:function(){},add:function(i){if(!c.checkAndShowLogin({callback:function(){location.replace(location)}})){return}var j={url:c.getApiURI(this.config.followUrl),parms:{starId:"",starName:""}};j.success=function(o){switch(o.status){case -1:var q=c.showMessage(o.msg);q.onHide=function(){if(j.onFailure){j.onFailure(o)}};setTimeout(function(){if(q){q.hide()}},4000);break;case 0:var n='<p class="sns-nf"><span>\u9a8c\u8bc1\u7801\uff1a</span><input type="text" maxlength="4" id="J_FollowCheckCode" class="f-txt" style="width:50px"/><img id="J_FollowCheckCodeImg" style="vertical-align:middle" width="100" src="'+SNS.sys.Helper.getApiURI(o.url)+'"/>(\u4e0d\u533a\u5206\u5927\u5c0f\u5199) &nbsp;<a href="#" id="J_FollowCheckCodeChange">\u6362\u4e00\u5f20</a></p>';var k,r,l;var m=SNS.sys.snsDialog({width:"410px",className:"checkCode",title:"\u8bf7\u8f93\u5165\u9a8c\u8bc1\u7801:",content:n,confirmBtn:function(){var p=d.get("J_FollowCheckCode");j.parms.TPL_checkcode=p.value;SNS.widget.Follow.add(j);m.hide()}});k=d.get("J_FollowCheckCode");r=d.get("J_FollowCheckCodeChange");l=d.get("J_FollowCheckCodeImg");a.on(r,"click",function(p){a.stopEvent(p);l.src=SNS.sys.Helper.getApiURI(o.url)});break;case 1:if(j.replaceSuccess){j.replaceSuccess(o)}else{var q=c.showMessage(o.msg);q.onHide=function(){if(j.onSuccess){j.onSuccess(o)}};setTimeout(function(){if(q){q.hide()}},4000)}break;case 2:if(j.replaceSuccess){j.replaceSuccess(o)}else{if(j.onSuccess){j.onSuccess(o)}}new SNS.widget.AddFriend({friendId:j.parms.starId,friendNick:j.parms.starName});break}};j=YAHOO.lang.merge(j,i||{});var g={data:j.parms,dataType:"json",success:j.success};var h=j.url;SNS.request(h,g)},cancel:function(i){if(!c.checkAndShowLogin({autoCallback:true})){return}var j={url:c.getApiURI(this.config.cancelFollowUrl),starId:""};j.success=function(k){var l;switch(k.message){case"false":l=c.showMessage("\u64cd\u4f5c\u5931\u8d25");l.onHide=function(){if(j.onFailure){j.onFailure(k)}};setTimeout(function(){if(l){l.hide()}},2000);break;case"true":if(j.replaceSuccess){j.replaceSuccess(k)}else{l=c.showMessage("\u53d6\u6d88\u5173\u6ce8\u6210\u529f");l.onHide=function(){if(j.onSuccess){j.onSuccess(k)}};setTimeout(function(){if(l){l.hide()}},2000)}break}};j=YAHOO.lang.merge(j,i||{});var g={data:{starId:j.starId},dataType:"json",success:j.success};var h=j.url;SNS.request(h,g)},recommendAction:function(g){var h={url:c.getApiURI(this.config.recommendUrl),handle:"",parms:{starName:"",starId:""}};h.success=function(i){switch(i.type){case"true":var j=c.showMessage(i.message);setTimeout(function(){if(j){j.hide()}},2000);break;case"false":j=c.showMessage(i.message);setTimeout(function(){if(j){j.hide()}},2000);break}};h=YAHOO.lang.merge(h,g);SNS.friendSuggest.decorate(d.get(h.handle),{type:"pop",title:"\u63a8\u8350"+h.parms.starName+"\u7ed9\u597d\u53cb",pos:[0,0],haveCheckAll:true,haveBtn:true,runnow:true,inputType:"checkbox",url:SNS.sys.Helper.getApiURI("http://jianghu.{serverHost}/json/spell_search_json.htm?filterId="+h.parms.starId),func:function(i){h.parms.fId=i;new SNS.sys.BasicDataSource(h).jsonp()}})},addBlackList:function(j,k,i){var h=this;var g=c.showConfirm("\u662f\u5426\u5c06\u8be5\u7528\u6237\u79fb\u5165\u9ed1\u540d\u5355\uff1f",function(){var l=k.success;k.success=function(m){l(m,g);g.hide()};SNS.request(i?i:c.getApiURI(h.config.addBlackListUrl),{data:{blackuserid:j.blackuserid},success:k.success})})},removeBlackList:function(j,k,i){var h=this;var g=c.showConfirm("\u662f\u5426\u5c06\u4ed6\u4ece\u9ed1\u540d\u5355\u4e2d\u53bb\u9664\uff1f",function(){var l=k.success;k.success=function(m){l(m,g);g.hide()};SNS.request(i?i:c.getApiURI(h.config.removeBlackListUrl),{data:{blackuserid:j.blackuserid},success:k.success})})}};SNS.widget.Follow=new b()},"SNS.util.Helper,SNS.util.Ajax");
