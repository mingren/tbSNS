(function(c,a){var b=function(e,f,d){b.Loader.run(e,f,d);return b};a.mix(b,{_init:function(g){var d=document.getElementsByTagName("script"),e=d[d.length-1],f=e.src.replace(/^(.*)(sns)(.source)?\.js[^/]*/i,"$1");this.config=g||{};this.config.base=f;this.namespace("util","data","widget","sys","app");return this},namespace:function(){return a.namespace.apply(this,arguments)},add:function(d,f,e){f&&f(this)},use:function(d){d&&d(this);return this},log:function(e,d){a.log(arguments)},base:"http://a.tbcdn.cn/app/sns/"});b._init({load:{t:20110415}});c.SNS=b})(window,KISSY);(function(d,k){var i=1,f=2,e=3,c=4,h=5,g=0;var l=function(m,n,o){this.fn=n||function(){};this.childs=o||[];this.parents=[];this.name=m||"MOD["+(g++)+"]";this.status=i};l.prototype={addParent:function(m){if(m.name==this.name){return}this.parents.push(m);m.childs.push(this)},attachNext:function(){var o,p=this.childs,n,m=this.childs.length;for(n=0;n<m;n++){o=p[n];if(!o.isAttached()){break}}if(o&&o.isAttaching()){o.run();this.attachNext()}if(o&&n==m&&o.isAttached()){this.ready()}},hasParent:function(){return this.parents.length>0},_notify:function(){var o,n,m=this.parents.length;for(n=0;n<m;n++){o=this.parents[n];o.attachNext(this)}},isReady:function(){var n,o,m=true;for(n=0;n<this.childs.length;n++){o=this.childs[n];if(!o.isAttached()){m=false;break}}return m},ready:function(){this.status=h;this._notify()},loadComplete:function(){this.status=f;if(this.isReady()){this.ready()}},isLoading:function(){return this.status==i},isLoaded:function(){return this.status==f},isAttaching:function(){return this.status==h},isAttached:function(){return this.status==c},run:function(){k.log("run "+this.name);this.status=c;this.fn(SNS,KISSY)}};var j=new l("root");var a={mods:{},add:function(m){var n=this.get(m.name);if(n){n.fn=m.fn;n.mixed=true}else{n=m;this.mods[m.name]=n}return n},get:function(m){return this.mods[m]}};var b={run:function(p,s,n){var r,q,m=this;if(k.isFunction(p)){n=s;s=p;p=undefined}if(!s){return}r=a.add(new l(p,s));if(!r.hasParent()){r.addParent(j)}n=(n||"").split(",");var o=function(v,t){if(v==""){return}var u=a.get(v);if(u){u.addParent(t)}else{u=a.add(new l(v));u.addParent(t);(function(w){m._load(w,{success:function(){var x=a.get(w);if(x.mixed){k.log("success "+w)}else{k.log("miss "+w)}},failure:function(){k.log(w+" is error")},timeout:function(){k.log(w+" is timeout")}})})(v)}};for(q=0;q<n.length;q++){if(k.trim(n[q])==""){continue}o(n[q],r)}if(!r.isAttached()){r.loadComplete()}},_load:function(n,o){if(!n){return}k.log("load "+n);var m=this;window.setTimeout(function(){k.getScript(m.nameToPath(n),o)},0)},nameToPath:function(m){var r,v,o,u,n,s,q,p=".js",w=SNS.config.load.t+".js";s=m.indexOf("http://");if(s==0){n=m}else{u=m.indexOf(".");r=m.toLowerCase().substring(0,u);v=m.toLowerCase().substring(u+1);if(k.Config.debug){p=".source"+p}n=this.cfg[r]+v.replace(/[.]/g,"/")+p+"?"+w}return n},combo:function(n,m){m=m.replace(/[.]/g,"/").replace(/[+]/g,".js,");return this.cfg[n]+"??"+m+".js"},_root:j,_resource:a,cfg:{sns:d.config.base}};d.Loader=b})(SNS,KISSY);
